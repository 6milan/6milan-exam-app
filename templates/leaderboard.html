{% extends "base.html" %}

{% block title %}Leaderboard - 6Milan Coding Academy{% endblock %}

{% block content %}
<div class="container my-4 my-md-5">

    <!-- Page Header -->
    <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-3 gap-3">
        <div>
            <h1 class="h4 fw-bold text-dark mb-1">
                <i class="fas fa-trophy text-warning me-2"></i>Leaderboard
            </h1>
            <p class="text-muted mb-0 small">Top performers • Updated {{ current_date }}</p>
        </div>
        <div class="text-start text-md-end small">
            <span class="text-muted">Active Students: <strong>{{ total_students }}</strong></span>
        </div>
    </div>

    <!-- Statistic Cards Smaller -->
    {% if total_students > 0 %}
    <div class="row g-2 mb-3">
        <div class="col-4 col-md-4">
            <div class="card border-0 shadow-sm text-white h-100" style="background: linear-gradient(135deg,#667eea,#764ba2);">
                <div class="card-body text-center py-2">
                    <i class="fas fa-users fa-lg mb-1 opacity-75"></i>
                    <h6 class="mb-0 small">{{ total_students }}</h6>
                    <p class="mb-0 small">Students</p>
                </div>
            </div>
        </div>
        <div class="col-4 col-md-4">
            <div class="card border-0 shadow-sm text-white h-100" style="background: linear-gradient(135deg,#f093fb,#f5576c);">
                <div class="card-body text-center py-2">
                    <i class="fas fa-chart-bar fa-lg mb-1 opacity-75"></i>
                    <h6 class="mb-0 small">{{ all_avg }}%</h6>
                    <p class="mb-0 small">Avg Score</p>
                </div>
            </div>
        </div>
        <div class="col-4 col-md-4">
            <div class="card border-0 shadow-sm text-white h-100" style="background: linear-gradient(135deg,#4facfe,#00f2fe);">
                <div class="card-body text-center py-2">
                    <i class="fas fa-medal fa-lg mb-1 opacity-75"></i>
                    <h6 class="mb-0 small">{{ top_performers|length }}</h6>
                    <p class="mb-0 small">Top 10</p>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Sort Buttons -->
    <div class="d-flex justify-content-center justify-content-md-end mb-3">
        <div class="btn-group btn-group-sm">
            <a href="{{ url_for('leaderboard', sort='average_desc') }}" class="btn btn-outline-primary {{ 'active' if current_sort == 'average_desc' else '' }}">Avg ↓</a>
            <a href="{{ url_for('leaderboard', sort='average_asc') }}" class="btn btn-outline-primary {{ 'active' if current_sort == 'average_asc' else '' }}">Avg ↑</a>
            <a href="{{ url_for('leaderboard', sort='exams_desc') }}" class="btn btn-outline-secondary {{ 'active' if current_sort == 'exams_desc' else '' }}">Exams ↓</a>
            <a href="{{ url_for('leaderboard', sort='score_desc') }}" class="btn btn-outline-secondary {{ 'active' if current_sort == 'score_desc' else '' }}">Score ↓</a>
        </div>
    </div>

    <!-- Leaderboard GRID -->
    <div class="row g-2 g-md-3">

        {% if top_performers %}
        {% for performer in top_performers %}
        <div class="col-12 col-sm-6 col-md-4 col-lg-3">

            <div class="card h-100 shadow-sm border-0 hover-shadow" style="border-radius:14px;">
                <div class="card-body p-2">

                    <!-- NAME AT TOP -->
                    <p class="text-center mb-1 small fw-bold text-primary text-truncate">
                        {{ performer.username }}
                    </p>

                    <div class="d-flex align-items-center mb-2">

                        <!-- Rank -->
                        <div class="me-2">
                            <div class="rounded-circle d-flex align-items-center justify-content-center text-white fw-bold"
                                 style="width: 34px; height: 34px; font-size: .9rem;
                                     background:
                                     {{ 'linear-gradient(45deg,#ffd700,#ffed4e)' if loop.index==1 else
                                        'linear-gradient(45deg,#c0c0c0,#e0e0e0)' if loop.index==2 else
                                        'linear-gradient(45deg,#cd7f32,#daa520)' if loop.index==3 else
                                        '#6c757d' }}">
                                {{ performer.rank }}
                            </div>
                        </div>

                        <!-- PROFILE PIC -->
                        {% if performer.profile_pic %}
                        <img src="{{ get_resized_profile_url(performer.profile_pic, width=80, height=80) }}"
                             class="rounded-circle shadow-sm"
                             style="width: 34px; height: 34px; object-fit: cover;">
                        {% else %}
                        <div class="rounded-circle d-flex align-items-center justify-content-center bg-secondary text-white fw-bold shadow-sm"
                             style="width: 34px; height: 34px; font-size: .9rem;">
                             {{ performer.username[0]|upper }}
                        </div>
                        {% endif %}

                    </div>

                    <!-- Stats compact -->
                    <div class="row text-center g-1 mt-1 pt-1 border-top small">
                        <div class="col-4">
                            <div class="text-muted tiny">Exams</div>
                            <div class="fw-bold">{{ performer.total_exams }}</div>
                        </div>
                        <div class="col-4">
                            <div class="text-muted tiny">Score</div>
                            <div class="fw-bold">{{ performer.total_score }}</div>
                        </div>
                        <div class="col-4">
                            <div class="text-muted tiny">Avg</div>
                            <div class="fw-bold text-success">{{ performer.average }}%</div>
                        </div>
                    </div>

                </div>
            </div>

        </div>
        {% endfor %}
        {% else %}
        <div class="col-12 text-center py-5">
            <i class="fas fa-chart-line fa-4x text-muted mb-3"></i>
            <h5 class="text-muted">No Scores Yet</h5>
        </div>
        {% endif %}

    </div>

</div>
{% endblock %}

{% block extra_css %}
<style>

.card {
    border-radius: 14px;
}

/* smaller overall card size */
.card-body{
    padding: 10px !important;
}

/* hover animation */
.hover-shadow{
    transition: .25s;
}
.hover-shadow:hover{
    transform: translateY(-3px);
    box-shadow: 0 6px 16px rgba(0,0,0,.12)!important;
}

/* truncate names */
.text-truncate{
    max-width: 140px;
}

/* super small font label for stats */
.tiny{
    font-size: 10px;
}

</style>
{% endblock %}
