<!-- templates/profile.html -->
{% extends "base.html" %}
{% block title %}My Profile{% endblock %}

{% block content %}
<div class="card shadow">
    <div class="card-body p-5">
        <div class="text-center mb-4">
            <img src="{{ url_for('uploaded_file', filename=current_user.profile_pic) }}" 
                 alt="Profile Picture" 
                 class="rounded-circle mb-3" 
                 style="width: 150px; height: 150px; object-fit: cover; border: 4px solid #4f46e5;">
            <h3>{{ current_user.username }}</h3>
            <p class="text-muted">{{ current_user.email }}</p>
            {% if upload_message %}
                <div class="alert alert-success">{{ upload_message }}</div>
            {% endif %}
        </div>

        <!-- Upload Form -->
        <form method="POST" enctype="multipart/form-data" class="mb-4">
            <div class="input-group">
                <input type="file" name="upload_pic" class="form-control" accept="image/*">
                <button type="submit" class="btn btn-outline-primary">Upload Picture</button>
            </div>
            <small class="text-muted">Max 5MB: JPG, PNG, GIF, WebP</small>
        </form>

        <hr>

        <h4 class="mb-3 text-center">Select Exam Category</h4>
        <form method="POST">
            {{ form.hidden_tag() }}
            <div class="input-group mb-4">
                {{ form.category(class="form-select") }}
                {{ form.submit(class="btn btn-primary") }}
            </div>
        </form>

        <h4 class="mb-3 text-center">Your Track Records</h4>
        <div style="height: 350px;">
            <canvas id="scoreChart"
                    data-labels='{{ chart_data.labels | tojson }}'
                    data-scores='{{ chart_data.data | tojson }}'></canvas>
        </div>
    </div>
</div>
{% endblock %}